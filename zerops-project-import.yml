project:
  name: discord-rag-bot
  envVariables:
    # PostgreSQL connection
    DB_HOST: ${db_hostname}
    DB_PORT: ${db_port}
    DB_NAME: ${db_dbName}
    DB_USER: ${db_user}
    DB_PASSWORD: ${db_password}

    # Object Storage
    AWS_ACCESS_KEY_ID: ${storage_accessKeyId}
    AWS_REGION: us-east-1
    AWS_BUCKET: ${storage_bucketName}
    AWS_ENDPOINT: ${storage_apiUrl}
    AWS_SECRET_ACCESS_KEY: ${storage_secretAccessKey}
    AWS_URL: ${storage_apiUrl}/${storage_bucketName}
    AWS_USE_PATH_STYLE_ENDPOINT: "true"

    # NATS
    NATS_URL: nats://${queue_hostname}:${queue_port}
    NATS_USER: ${queue_user}
    NATS_PASSWORD: ${queue_password}

    # Qdrant
    QDRANT_URL: ${qdrant_connectionString}
    QDRANT_API_KEY: ${qdrant_apiKey}

    # Valkey/Redis
    REDIS_HOST: ${cache_hostname}
    REDIS_PORT: "6379"

services:
  - hostname: db
    type: postgresql@16
    mode: NON_HA
    priority: 100

  - hostname: cache
    type: valkey@7.2
    mode: NON_HA
    priority: 100

  - hostname: queue
    type: nats@2.10
    mode: NON_HA
    priority: 100

  - hostname: qdrant
    type: qdrant@1.12
    mode: NON_HA
    priority: 100

  - hostname: storage
    type: object-storage
    objectStorageSize: 1
    objectStoragePolicy: private
    priority: 100

  - hostname: api
    type: python@3.11
    buildFromGit: https://github.com/your-username/your-repo-name
    enableSubdomainAccess: false
    minContainers: 1
    envSecrets:
      WORKERS: "1"
      API_SECRET_KEY: ""
      ADMIN_DISCORD_ID: ""
      ALLOWED_GUILD_ID: ""
      ENVIRONMENT: "production"
      MAX_FILE_SIZE: "10485760"
      ALLOWED_FILE_EXTENSIONS: ".pdf,.txt,.md"
      ALLOWED_MIME_TYPES: "application/pdf,text/plain,text/markdown"
      USE_OPENAI: "false"
      USE_GEMINI: "false"
      USE_ANTHROPIC: "false"
      OPENAI_API_KEY: ""
      GEMINI_API_KEY: ""
      ANTHROPIC_API_KEY: ""
      OPENAI_MODEL: "gpt-3.5-turbo"
      ANTHROPIC_MODEL: "claude-3-sonnet-20240229"
      EMBEDDING_MODEL: "all-MiniLM-L6-v2"
      CHUNK_SIZE: "1000"
      CHUNK_OVERLAP: "200"
      MAX_CHUNKS_PER_DOC: "100"
      RETRIEVAL_K: "5"
      CACHE_TTL: "3600"
      BATCH_SIZE: "10"
      WORKER_TIMEOUT: "300"
      USE_EXA: "false"
      EXA_API_KEY: ""
    priority: 50

  - hostname: processor
    type: python@3.11
    buildFromGit: https://github.com/your-username/your-repo-name
    minContainers: 1
    envSecrets:
      USE_OPENAI: "false"
      USE_GEMINI: "false"
      USE_ANTHROPIC: "false"
      OPENAI_API_KEY: ""
      GEMINI_API_KEY: ""
      ANTHROPIC_API_KEY: ""
      OPENAI_MODEL: "gpt-3.5-turbo"
      ANTHROPIC_MODEL: "claude-3-sonnet-20240229"
      EMBEDDING_MODEL: "all-MiniLM-L6-v2"
      CHUNK_SIZE: "1000"
      CHUNK_OVERLAP: "200"
      MAX_CHUNKS_PER_DOC: "100"
      RETRIEVAL_K: "5"
      CACHE_TTL: "3600"
      BATCH_SIZE: "10"
      WORKER_TIMEOUT: "300"
      MAX_FILE_SIZE: "50000000"
      USE_EXA: "false"
      EXA_API_KEY: ""
    priority: 50

  - hostname: bot
    type: python@3.11
    buildFromGit: https://github.com/your-username/your-repo-name
    minContainers: 1
    envSecrets:
      DISCORD_BOT_TOKEN: ""
      API_SECRET_KEY: ""
      ADMIN_DISCORD_ID: ""
      ALLOWED_GUILD_ID: ""
      MAX_FILE_SIZE: "10485760"
      ALLOWED_FILE_EXTENSIONS: ".pdf,.txt,.md"
      USE_CHANNEL: "false"
      CHANNEL_ID: ""
      DEFAULT_LLM_PROVIDER: "openai"
    priority: 40
